\chapter{First Order Logic (in construction)}
\label{chap:fol}

\section{Data types}

\subsection{Languages}

A \emph{language} is a structure composed of relation and function symbols, each symbol is given an \emph{arity} (number of arguments).

From~\href{../theories/html/hydras.Ackermann.fol.html}{Ackermann.fol}
\inputsnippets{fol/LanguageDef} 

In ~\href{../theories/html/hydras.Ackermann.Languages.html}{Ackermann.Languages}, we can find two examples of languages built with the usual symbols of arithmetic.

The first language, \texttt{LNT} (\emph{Language of Number Theory}) has just function symbols for $+$, $\times$, $0$ and successor.




The second language, LNN, is the language of NN (\emph{Natural Numbers}) and has
the same function symbols as LNT plus one relation symbol for less than, LT.

First, we declare two ranked alphabets. 
\inputsnippets{Languages/LNTDef1} 

In a second time, we build \texttt{LNT} and \texttt{LNN} by filling \texttt{Language}'s \texttt{arity} field.

\inputsnippets{Languages/LNTDef2} 


Let us show a few examples (from ~\href{../theories/html/hydras.MoreAck.fol_Examples.html}{MoreAck.fol\_Examples}).

\inputsnippets{fol_Examples/arityTest} 


\subsection{Terms}

Given a language $L$, we define the set of \emph{terms} and
$n$-\emph{tuples} of terms.

\inputsnippets{fol/TermDef} 


For instance the term $v_1+0$, where $v_1$ is a variable,
is represented by a term of type (\texttt{Term LNN}).

\inputsnippets{fol_Examples/v1Plus0} 

\subsection{Formulas}



The type of first order formulas over $L$ is defined 
in~\href{../theories/html/hydras.Ackermann.fol.html}{Ackermann.fol} as an inductive data type.

\inputsnippets{fol/FormulaDef}

The full abstract syntax of first-order formulas is completed 
with a few more notations. Note that we are studying \emph{classical} first-order logic, so the existential quantifier is derived from the universal one through negation. 

\inputsnippets{fol/FolFull, fol/folPlus}

\subsection{Examples}


For instance, the term $v_1+0$ is written as below.

\inputsnippets{fol_Examples/v1Plus0}

Let us give a few examples of first-order formulas.

\label{fol:examplesf1f2f3}
\begin{enumerate}
\item $\forall\,v_0, v_0=0 \vee \exists\;v_1,\, v_0= S\;v_1$
\item $\exists\,v_2,\, 0< v_2 \wedge 4=v_2+v_2$
\item $ v_0=0 \vee \exists\;v_1,\, v_0= S\;v_1$
\item $v_0= v_1 + v_1 \leftrightarrow v_0 = v_1 \times 2$
\end{enumerate}
\inputsnippets{fol_Examples/f1Example}



\begin{todo}
Comment on the use of boths list and sets of formulas.
(explained in Russel's paper, p.7).

\inputsnippets{fol/SystemDef} 

\end{todo}


\subsection{Decidability of equality}

Under the assumption that equality is decidable on 
function and relation symbols of any language $L$,
we get decidability of equality on terms and formulas.
Because of dependent types, the proofs are quite long and technical. The reader may consult them in \href{../theories/html/hydras.Ackermann.fol.html}{Ackermann.fol}

\begin{todo}
  Should we talk about the decomposition lemmas
\texttt{nilTerms} and \texttt{consTerms} ?
\end{todo}

\inputsnippets{fol/formDec1, fol/formDec2,
fol/formDec3,fol/formDec4,fol/formDec5}

\subsection{Induction principles on formula depth}

The purpose of this section is to present ways of proving 
properties of any formula $a$ (or defining functions over the type of formulas).

Structural induction/recursion principles are generated by 
\texttt{Formula}'s definition, for instance:

\inputsnippets{fol_Examples/FormulaRect}







\subsubsection{Depth of a formula}
As explained in~\cite{OConnor05}, some functions on the \texttt{Formula} type cannot be defined by structural recursion in 
O'Connors formalization. For instance, the substitution of a term to a free variable (because of quantifiers). 
In such cases, we may define functions by well-founded recursion. In this section, we consider the well-founded strict-order associated with a measure: the \emph{depth} of a formula.

\begin{todo}
Forward link to its application.
\end{todo}


The function \texttt{depth} computes the \emph{depth} of the 
 skeleton of any formula.

\inputsnippets{fol/depthDef,  fol_Examples/DepthCompute}

\subsubsection{Induction on depth}

The function \texttt{depth} allows us to define a strict order on 
\texttt{Formula $L$}.


\inputsnippets{fol_Examples/ltDepth1}

\begin{todo}
Motivate the induction principles based on depth. Compatible with term substitution and universal quantifier elimination.
\end{todo}



\inputsnippets{fol_Examples/depthRecDemo}

\begin{todo}
 Look for the principles which are really used in Ackermann or/and Goedel libraries, and comment them.
 Maybe skip the helpers (unused in other files)
\end{todo}

The library~\href{../theories/html/hydras.Ackermann.fol.html}{Ackermann.fol} contains several induction principles, applied 
throughout \texttt{Ackermann} and \texttt{Goedel} projects.


Let us for instance have a look  at \texttt{Formula\_depth\_ind2}. Its application in order to prove $P\;a$ generates 5 sub-goals. 

\inputsnippets{fol_Examples/depthRecDemo2}

\begin{itemize}
\item Goals $1$ to $4$ correspond to  usual proofs by structural induction.
\item Goal $5$ is associated with a universal quantification $f=\forall\,v,a$. In this case, we have to prove that $P\;b$ holds for any formula $b$ which has a depth strictly less than $f$. Such a $b$ may for instance the result of replacing the free occurrences of $v$ in $a$ with any term $t$.
  \begin{todo}
   Make a link to an appropriate example.
  \end{todo}
\end{itemize}



\subsection{Free variables and substitutions}

Section \texttt{Free\_Variables} 
of~\href{../theories/html/hydras.Ackermann.fol.html}{Ackermann.fol} defines the list of free variables which occur in a term (respectively in a formula).

We advise the reader to look at these functions, and limit ourselves to give a few examples.

Let us consider again the formulas \texttt{f3} and \texttt{f4} of page~\pageref{fol:examplesf1f2f3}.

The list of free variable occurrences of a formula is given by the function \texttt{freeVarFormula}. The function \texttt{close}
binds all the free variables of a formula with universal quantifiers.

\inputsnippets{fol_Examples/freeVarExamples}







\inputsnippets{LNN/instantiations}

\section{Notations for Formulas (experimental)}

In order to get more readable terms and formulas, we can define a few notations in ~\href{../theories/html/hydras.MoreAck.FOL_notations.html}{MoreAck.FOL\_notations} and
~\href{../theories/html/hydras.MoreAck.LNN_notations.html}{MoreAck.LNN\_notations}.
Please note that these notation scopes are experimental: We are going to use them in examples and exercises before using them in large original proof scripts (in the \texttt{ordinals/Ackermann/} sub-directory).

We try to define notation scopes as close as possible to \coq's syntax for propositions.

Let us take for instance the following proposition (in math form):

$$\forall\, v_0,\, v_0=0\vee \exists\,v_1,\,v_1=1+v_0$$

Here is a definition, using directly the \texttt{goedel/Ackermann}'s project syntax.

\inputsnippets{LNN_Examples/uglyF0}

Note that, because of redefinitions, the disjonction \texttt{orH}
can be expanded in terms of  implication and negation (for instance when we use \texttt{Compute}).

\inputsnippets{LNN_Examples/uglyF0a}



\inputsnippets{LNN_Examples/CNNF0}




\section{Proofs}

\subsection{Contexts as lists}


\begin{exercise}

Prove the following lemma:
\inputsnippets{fol_Examples/eqRefl}

\end{exercise}

\subsection{Contexts as sets}

\begin{exercise}

Prove the following lemma:
\inputsnippets{fol_Examples/MPdiag}

\end{exercise}


\section{Derived rules and natural deduction}


 The library 
 \href{../theories/html/hydras.Ackermann.folLogic.html}{Ackermann.folLogic} contains many derived rules which allow the user to build proofs in a natural deduction style (with introduction and elimination rules).

\subsection{Example}

For instance, let us prove Peirce's rule.
 (in  ~\href{../theories/html/hydras.MoreAck.folPeirce.html}{MoreAck.folPeirce} ).

\subsubsection{Prelude}

\inputsnippets{folPeirce/prelude}


\subsection{Proof of Pierce's law}


\inputsnippets{folPeirce/PeirceProof}

Let us try to do an implication introduction.

\inputsnippets{folPeirce/step1}

Now, we may use the law of excluded middle with the formula $P$. The only non-trivial case is about $\sim P$.

\inputsnippets{folPeirce/step2}

The rest of the proof is composed of basic proof steps, 
and bookkeeping steps (about \texttt{Ensembles.In}).

\inputsnippets{folPeirce/step3, folPeirce/step4}



